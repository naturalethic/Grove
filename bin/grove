#!/usr/bin/env node

const { build } = require("esbuild");

build({
    entryPoints: ["src/cli/index.ts"],
    bundle: true,
    platform: "node",
    outfile: "build/cli.js",
    // external: ["esbuild", "*.node"],
    // plugins: [
    //     {
    //         name: "make-all-packages-external",
    //         setup(build) {
    //             let filter = /^[^.\/]|^\.[^.\/]|^\.\.[^\/]/; // Must not start with "/" or "./" or "../"
    //             build.onResolve({ filter }, (args) => {
    //                 console.log(args.path);
    //                 return {
    //                     path: args.path,
    //                     external: true,
    //                 };
    //             });
    //         },
    //     },
    // ],
    plugins: [
        {
            name: "make-all-packages-external",
            setup(build) {
                // let filter = /^[^.\/]|^\.[^.\/]|^\.\.[^\/]/; // Must not start with "/" or "./" or "../"
                const filter = /^[a-z]/;
                build.onResolve({ filter }, (args) => {
                    // console.log(args.path);
                    return {
                        path: args.path,
                        external: true,
                    };
                });
            },
        },
    ],
}).then(() => {
    require("../build/cli");
});
